

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Supervised Learning Tutorial &mdash; Rasa Core 0.7.0a9 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rasa Core 0.7.0a9 documentation" href="index.html"/>
        <link rel="next" title="Interactive Learning with a Fake User" href="tutorial_fake_user.html"/>
        <link rel="prev" title="A Bot From Scratch" href="tutorial_scratch.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rasa Core
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="read_first.html">Read this first</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation and Hello World</a></li>
<li class="toctree-l1"><a class="reference internal" href="tour.html">A Quick Tour (no ML)</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_scratch.html">A Bot From Scratch</a></li>
</ul>
<p class="caption"><span class="caption-text">More Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Supervised Learning Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#meta">Meta</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-dataset">The Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training-your-bot">Training your bot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#train-nlu-model">1. Train NLU model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#train-dialogue-policy">2. Train Dialogue Policy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#domain">Domain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#policy">Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#training">Training</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-your-bot">Using your bot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_fake_user.html">Interactive Learning with a Fake User</a></li>
</ul>
<p class="caption"><span class="caption-text">Deep Dives</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="patterns.html">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="plumbing.html">Plumbing - How it all fits together</a></li>
<li class="toctree-l1"><a class="reference internal" href="http.html">Rasa Core as a HTTP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="domains.html">Domain, Slots, and Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="connectors.html">Connecting to messaging &amp; voice platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="stories.html">Training Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduling.html">Scheduling Reminders</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/agent.html">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/events.html">Events</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="featurisation.html">Featurization</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpreters.html">Interpreters</a></li>
<li class="toctree-l1"><a class="reference internal" href="policies.html">Creating Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="state.html">Tracking Conversation State</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rasa Core</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Supervised Learning Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial_babi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><b>Warning:</b> This document is for an old version of Rasa Core.</p>

<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="supervised-learning-tutorial">
<span id="tutorial-babi"></span><h1>Supervised Learning Tutorial<a class="headerlink" href="#supervised-learning-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="meta">
<h2>Meta<a class="headerlink" href="#meta" title="Permalink to this headline">¶</a></h2>
<p>In this example we will create a restaurant search bot, by training
a neural net on example conversations.</p>
<p>A user can contact the bot with something close to &#8220;I want a mexican restaurant!&#8221;
and the bot will ask more details until it is ready to suggest a restaurant.</p>
<p>This assumes you already know what the <code class="docutils literal"><span class="pre">Domain</span></code>, <code class="docutils literal"><span class="pre">Policy</span></code>, and <code class="docutils literal"><span class="pre">Action</span></code> classes do.
If you don&#8217;t, it&#8217;s a good idea to read the basic tutorial first.</p>
</div>
<div class="section" id="the-dataset">
<h2>The Dataset<a class="headerlink" href="#the-dataset" title="Permalink to this headline">¶</a></h2>
<p>The training conversations come from the <a class="reference external" href="https://research.fb.com/downloads/babi/">bAbI dialog task</a> .
However, the messages in these dialogues are machine generated, so we will augment
this dataset with real user messages from the <a class="reference external" href="http://camdial.org/~mh521/dstc/">DSTC dataset</a>.
Lucky for us, this dataset is also in the restaurant domain.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the babi dataset is machine-generated, and there are a LOT of dialogues in there.
There are 1000 stories in the training set, but you don&#8217;t need that many to build
a useful bot. How much data you need depends on the number of actions you define, and the
number of edge cases you want to support. But a few dozen stories is a good place to start.</p>
</div>
<p>Here&#8217;s an example conversation snippet:</p>
<div class="highlight-md"><div class="highlight"><pre><span></span><span class="gu">##</span> story_07715946
<span class="k">*</span> _greet[]
 <span class="k">-</span> action_ask_howcanhelp
<span class="k">*</span> _inform[location=rome,price=cheap]
 <span class="k">-</span> action_on_it
 <span class="k">-</span> action_ask_cuisine
<span class="k">*</span> _inform[cuisine=spanish]
 <span class="k">-</span> action_ask_numpeople
<span class="k">*</span> _inform[people=six]
 <span class="k">-</span> action_ack_dosearch
 ...
</pre></div>
</div>
<p>You can read about the Rasa data format here : <a class="reference internal" href="stories.html#stories"><span class="std std-ref">Training Data Format</span></a>.
It may be worth browsing through <code class="docutils literal"><span class="pre">data/babi_task5_trn_rasa_with_slots.md</span></code> to get a sense of how these work.</p>
<p>We can also visualize that training data to generate a graph which is similar to a flow chart:</p>
<img alt="_images/babi_flow.png" src="_images/babi_flow.png" />
<p>The chart shows the incoming user intents and entities and the action the bot is supposed to execute based on
the stories from the training data. As you can see, flow charts get complicated quite quickly. Nevertheless, they
can be a helpful tool in debugging a bot. More information can be found in <a class="reference internal" href="stories.html#story-visualization"><span class="std std-ref">Visualization of story training data</span></a>.</p>
</div>
<div class="section" id="training-your-bot">
<h2>Training your bot<a class="headerlink" href="#training-your-bot" title="Permalink to this headline">¶</a></h2>
<p>We can go directly from data to bot with only a few steps:</p>
<ol class="arabic simple">
<li>train a Rasa NLU model to extract intents and entities. Read more about that in the <a class="reference external" href="http://rasa-nlu.readthedocs.io/">NLU docs</a>.</li>
<li>train a dialogue policy which will learn to choose the correct actions</li>
<li>set up an agent which has both model 1 and model 2 working together to go directly from <strong>user input</strong> to <strong>action</strong></li>
</ol>
<p>We will go through these steps one by one.</p>
<div class="section" id="train-nlu-model">
<h3>1. Train NLU model<a class="headerlink" href="#train-nlu-model" title="Permalink to this headline">¶</a></h3>
<p>Our <code class="docutils literal"><span class="pre">train_nlu.py</span></code> program looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_babi_nlu</span><span class="p">():</span>
    <span class="n">training_data</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="s1">&#39;examples/babi/data/franken_data.json&#39;</span><span class="p">)</span>
    <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span><span class="n">RasaNLUConfig</span><span class="p">(</span><span class="s2">&quot;examples/babi/data/config_nlu.json&quot;</span><span class="p">))</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_data</span><span class="p">)</span>
    <span class="n">model_directory</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="s1">&#39;examples/babi/models/nlu/&#39;</span><span class="p">,</span>
                                      <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_directory</span>
</pre></div>
</div>
<p>You can learn all about Rasa NLU starting from the
<a class="reference external" href="https://github.com/RasaHQ/rasa_nlu">github repository</a>.
What you need to know though is that <code class="docutils literal"><span class="pre">interpreter.parse(user_message)</span></code> returns
a dictionary with the intent and entities from a user message.</p>
<p><em>This step takes approximately 18 seconds on a 2014 MacBook Pro.</em></p>
</div>
<div class="section" id="train-dialogue-policy">
<h3>2. Train Dialogue Policy<a class="headerlink" href="#train-dialogue-policy" title="Permalink to this headline">¶</a></h3>
<p>Now our bot needs to learn what to do in response to these messages.
We do this by training the Rasa Core model. From <code class="docutils literal"><span class="pre">train_dm.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_babi_dm</span><span class="p">():</span>
    <span class="n">training_data_file</span> <span class="o">=</span> <span class="s1">&#39;examples/babi/data/babi_task5_trn_rasa_with_slots.md&#39;</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;examples/babi/models/policy/current&#39;</span>

    <span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="s2">&quot;examples/restaurant_domain.yml&quot;</span><span class="p">,</span>
                  <span class="n">policies</span><span class="o">=</span><span class="p">[</span><span class="n">MemoizationPolicy</span><span class="p">(),</span> <span class="n">RestaurantPolicy</span><span class="p">()])</span>

    <span class="n">agent</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
            <span class="n">training_data_file</span><span class="p">,</span>
            <span class="n">max_history</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">augmentation_factor</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

    <span class="n">agent</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates a <code class="docutils literal"><span class="pre">policy</span></code> object. What you need to know is that <code class="docutils literal"><span class="pre">policy.next_action</span></code> chooses
which action the bot should take next.</p>
<p>Here we&#8217;ll quickly explain the Domain and Policy objects,
feel free to skip this if you don&#8217;t care, or read <a class="reference internal" href="plumbing.html#plumbing"><span class="std std-ref">Plumbing - How it all fits together</span></a> for more info.</p>
<div class="section" id="domain">
<h4>Domain<a class="headerlink" href="#domain" title="Permalink to this headline">¶</a></h4>
<p>Let&#8217;s start with <code class="docutils literal"><span class="pre">Domain</span></code>. From <code class="docutils literal"><span class="pre">restaurant_domain.yml</span></code>:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">slots</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">cuisine</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
  <span class="l l-Scalar l-Scalar-Plain">people</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
  <span class="l l-Scalar l-Scalar-Plain">location</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
  <span class="l l-Scalar l-Scalar-Plain">price</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
  <span class="l l-Scalar l-Scalar-Plain">info</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
  <span class="l l-Scalar l-Scalar-Plain">matches</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">list</span>

<span class="l l-Scalar l-Scalar-Plain">intents</span><span class="p p-Indicator">:</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">greet</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">affirm</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">deny</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">inform</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">thankyou</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">request_info</span>

<span class="l l-Scalar l-Scalar-Plain">entities</span><span class="p p-Indicator">:</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">location</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">info</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">people</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">price</span>
 <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cuisine</span>

<span class="l l-Scalar l-Scalar-Plain">templates</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_greet</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;hey</span><span class="nv"> </span><span class="s">there!&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_goodbye</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;goodbye</span><span class="nv"> </span><span class="s">:(&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_default</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;default</span><span class="nv"> </span><span class="s">message&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ack_dosearch</span><span class="p p-Indicator">:</span> 
    <span class="p p-Indicator">-</span> <span class="s">&quot;ok</span><span class="nv"> </span><span class="s">let</span><span class="nv"> </span><span class="s">me</span><span class="nv"> </span><span class="s">see</span><span class="nv"> </span><span class="s">what</span><span class="nv"> </span><span class="s">I</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">find&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ack_findalternatives</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;ok</span><span class="nv"> </span><span class="s">let</span><span class="nv"> </span><span class="s">me</span><span class="nv"> </span><span class="s">see</span><span class="nv"> </span><span class="s">what</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">there</span><span class="nv"> </span><span class="s">is&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ack_makereservation</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;ok</span><span class="nv"> </span><span class="s">making</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">reservation&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ask_cuisine</span><span class="p p-Indicator">:</span> 
    <span class="p p-Indicator">-</span> <span class="s">&quot;what</span><span class="nv"> </span><span class="s">kind</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">cuisine</span><span class="nv"> </span><span class="s">would</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">like?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ask_helpmore</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;is</span><span class="nv"> </span><span class="s">there</span><span class="nv"> </span><span class="s">anything</span><span class="nv"> </span><span class="s">more</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">I</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">help</span><span class="nv"> </span><span class="s">with?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ask_howcanhelp</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;how</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">I</span><span class="nv"> </span><span class="s">help</span><span class="nv"> </span><span class="s">you?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ask_location</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;in</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">city?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ask_moreupdates</span><span class="p p-Indicator">:</span> 
    <span class="p p-Indicator">-</span> <span class="s">&quot;anything</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">you&#39;d</span><span class="nv"> </span><span class="s">like</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">modify?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ask_numpeople</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;for</span><span class="nv"> </span><span class="s">how</span><span class="nv"> </span><span class="s">many</span><span class="nv"> </span><span class="s">people?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_ask_price</span><span class="p p-Indicator">:</span> 
    <span class="p p-Indicator">-</span> <span class="s">&quot;in</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">price</span><span class="nv"> </span><span class="s">range?&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">utter_on_it</span><span class="p p-Indicator">:</span> 
    <span class="p p-Indicator">-</span> <span class="s">&quot;I&#39;m</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">it&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_greet</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_goodbye</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_default</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ack_dosearch</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ack_findalternatives</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ack_makereservation</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ask_cuisine</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ask_helpmore</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ask_howcanhelp</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ask_location</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ask_moreupdates</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ask_numpeople</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_ask_price</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">utter_on_it</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">examples.restaurant_example.ActionSearchRestaurants</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">examples.restaurant_example.ActionSuggest</span>
</pre></div>
</div>
<p>Our <code class="docutils literal"><span class="pre">Domain</span></code> has clearly defined <code class="docutils literal"><span class="pre">slots</span></code> (in our case criterion for target restaurant) and <code class="docutils literal"><span class="pre">intents</span></code>
(what the user can send). It also requires <code class="docutils literal"><span class="pre">templates</span></code> to have text to use to respond given a certain <code class="docutils literal"><span class="pre">action</span></code>.</p>
<p>Each of these <code class="docutils literal"><span class="pre">actions</span></code> must either be named after an utterance (dropping the <code class="docutils literal"><span class="pre">utter_</span></code> prefix)
or must be a module path to an action. Here is the code for one the two custom actions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rasa_core.actions</span> <span class="k">import</span> <span class="n">Action</span>

<span class="k">class</span> <span class="nc">ActionSearchRestaurants</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;search_restaurants&#39;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">,</span> <span class="n">tracker</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="n">utter_message</span><span class="p">(</span><span class="s2">&quot;here&#39;s what I found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">name</span></code> method is to match up actions to utterances, and the <code class="docutils literal"><span class="pre">run</span></code> command is run whenever the action is called. This
may involve api calls or internal bot dynamics.</p>
</div>
<div class="section" id="policy">
<h4>Policy<a class="headerlink" href="#policy" title="Permalink to this headline">¶</a></h4>
<p>From <code class="docutils literal"><span class="pre">examples/restaurant_example.py</span></code> again:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RestaurantPolicy</span><span class="p">(</span><span class="n">KerasPolicy</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_build_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">,</span> <span class="n">max_history_len</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a keras model and return a compiled model.</span>
<span class="sd">        :param max_history_len: The maximum number of historical turns used to</span>
<span class="sd">                                decide on next action&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">keras.layers</span> <span class="k">import</span> <span class="n">LSTM</span><span class="p">,</span> <span class="n">Activation</span><span class="p">,</span> <span class="n">Masking</span><span class="p">,</span> <span class="n">Dense</span>
        <span class="kn">from</span> <span class="nn">keras.models</span> <span class="k">import</span> <span class="n">Sequential</span>

        <span class="n">n_hidden</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># size of hidden layer in LSTM</span>
        <span class="c1"># Build Model</span>
        <span class="n">batch_shape</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_history_len</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Masking</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">batch_input_shape</span><span class="o">=</span><span class="n">batch_shape</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">batch_input_shape</span><span class="o">=</span><span class="n">batch_shape</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">n_hidden</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="n">num_actions</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>

        <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>
                      <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
                      <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
<p>This policy builds an  LSTM in Keras  which will then be taken by the trainer and trained. The parameters <code class="docutils literal"><span class="pre">max_history_len</span></code>
and <code class="docutils literal"><span class="pre">n_hidden</span></code> may be altered dependent on the task complexity and the amount of data one has. <code class="docutils literal"><span class="pre">max_history_len</span></code> is
important as it is the amount of story steps the network has access to to make a classification.</p>
</div>
<div class="section" id="training">
<h4>Training<a class="headerlink" href="#training" title="Permalink to this headline">¶</a></h4>
<p>Now we can simply run <code class="docutils literal"><span class="pre">python</span> <span class="pre">train_dm.py</span></code> to get our trained policy.</p>
<p><em>This step takes roughly 12 minutes on a 2014 MacBook Pro</em></p>
</div>
</div>
</div>
<div class="section" id="using-your-bot">
<h2>Using your bot<a class="headerlink" href="#using-your-bot" title="Permalink to this headline">¶</a></h2>
<p>Now we have a trained NLU and DM model which can be merged together to make a bot. This is done using an <code class="docutils literal"><span class="pre">Agent</span></code>
object. From <code class="docutils literal"><span class="pre">run.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_babi</span><span class="p">(</span><span class="n">serve_forever</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;examples/babi/models/policy/current&quot;</span><span class="p">,</span>
                       <span class="n">interpreter</span><span class="o">=</span><span class="n">RasaNLUInterpreter</span><span class="p">(</span><span class="n">nlu_model_path</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">serve_forever</span><span class="p">:</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">handle_channel</span><span class="p">(</span><span class="n">ConsoleInputChannel</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">agent</span>
</pre></div>
</div>
<p>We put the NLU model into an <code class="docutils literal"><span class="pre">Interpreter</span></code> and then put that into an <code class="docutils literal"><span class="pre">Agent</span></code>.</p>
<p>You now have a working bot! It will recommend you the same place (papi&#8217;s pizza place) no matter what preferences you
give, but at least its trying!</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial_fake_user.html" class="btn btn-neutral float-right" title="Interactive Learning with a Fake User" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial_scratch.html" class="btn btn-neutral" title="A Bot From Scratch" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Rasa Technologies GmbH.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 0.6.9
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../0.8.5/index.html">0.8.5</a></dd>
            <dd><a href="../0.8.4/index.html">0.8.4</a></dd>
            <dd><a href="../0.8.3/index.html">0.8.3</a></dd>
            <dd><a href="../0.8.2/index.html">0.8.2</a></dd>
            <dd><a href="../0.8.1/index.html">0.8.1</a></dd>
            <dd><a href="../0.8.0/index.html">0.8.0</a></dd>
            <dd><a href="../0.7.9/index.html">0.7.9</a></dd>
            <dd><a href="tutorial_babi.html">0.6.9</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../master/index.html">master</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0a9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>